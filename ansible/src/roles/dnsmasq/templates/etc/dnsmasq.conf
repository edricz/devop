{% set listen_addresses = [] %}

{% for iface in interfaces %}
  {% if hostvars[inventory_hostname]["ansible_" + iface] is defined %}
    {% set _ = listen_addresses.append(hostvars[inventory_hostname]["ansible_" + iface].ipv4.address) %}
  {% endif %}
{% endfor %}

resolv-file=/etc/resolv.dnsmasq
listen-address={{ listen_addresses | join(",") }},127.0.0.1
no-hosts
cache-size=100000
no-negcache
dns-forward-max=2000
max-cache-ttl=15
